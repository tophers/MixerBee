<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>MixerBee</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Hidden select for user ID. Required by JS, but multi-user feature is disabled due to Emby API issues. -->
    <select id="user-select" style="display: none;"></select>

    <h2 style="margin-top: 2.5rem;">MixerBee</h2>

    <div class="tab-switcher">
        <button id="mixed-tab-btn" class="tab-btn active">Builder</button>
        <button id="scheduler-tab-btn" class="tab-btn">Scheduler</button>
        <button id="manager-tab-btn" class="tab-btn">Manager</button>
    </div>

    <div id="mixed-pane" class="tab-pane active" style="display: block;">
        <div class="container">
            <div class="preset-controls">
                <label class="control-item" for="load-preset-select">
                    <span>Load Preset</span>
                    <select id="load-preset-select">
                        <option value="">-- Select a preset --</option>
                    </select>
                </label>
                <div class="preset-buttons button-group">
                    <button id="save-preset-btn" type="button" class="secondary">Save as Preset</button>
                    <button id="delete-preset-btn" type="button" class="secondary">Delete Preset</button>
                    <button id="import-preset-btn" type="button" class="secondary">Import</button>
                    <button id="export-preset-btn" type="button" class="secondary" disabled>Export</button>
                </div>
            </div>
             <fieldset id="ai-generator-container" class="filter-group" style="display: none;">
                <legend style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>AI Block Builder</span>
                </legend>
                <textarea id="ai-prompt-input" rows="2" placeholder="e.g., A block of 80s action movies followed by some episodes of Star Trek TNG and The Orville" style="width: 100%; box-sizing: border-box; resize: vertical; margin-bottom: 0.5rem;"></textarea>
                <div class="button-group" style="justify-content: flex-end;">
                    <button id="generate-with-ai-btn" type="button" class="secondary">Generate with AI</button>
                </div>
            </fieldset>
            <fieldset class="filter-group">
                <legend>Quick Playlists</legend>
                <div class="button-group quick-playlist-buttons">
                    <button type="button" class="secondary" id="pilot-sampler-btn" title="Creates a Random Playlist of Pilot Episodes"><i data-feather="film"></i> Pilot Sampler</button>
                    <button type="button" class="secondary" id="continue-watching-btn" title="Creates a playlist from your most recent in-progress shows"><i data-feather="play"></i> Next Up</button>
                    <button id="forgotten-favorites-btn" type="button" class="secondary" title="Creates a playlist of favorited movies you haven't watched in a while"><i data-feather="archive"></i> From the Vault</button>
                    <button id="random-genre-marathon-btn" type="button" class="secondary" title="Creates a movie marathon from a randomly selected genre"><i data-feather="shuffle"></i> Genre Roulette</button>
                </div>
            </fieldset>
            <div id="mixed-playlist-blocks">
                <p class="placeholder-text">Click below to add your first block...</p>
            </div>
            <div id="add-block-controls" class="button-group">
                <button id="add-tv-block-btn" class="secondary"><i data-feather="plus"></i> Add TV Block</button>
                <button id="add-movie-block-btn" class="secondary"><i data-feather="plus"></i> Add Movie Block</button>
                <button id="clear-all-blocks-btn" type="button" class="secondary" style="margin-left: auto;">Clear All Blocks</button>
            </div>
        </div>
    </div>

    <div id="scheduler-pane" class="tab-pane" style="display: none;">
        <div class="container">
            <h3>Create a New Schedule</h3>
            <p style="font-size: 0.9em; color: var(--text-subtle); margin-top: -1rem; margin-bottom: 1.5rem;">
                Schedules will automatically rebuild a playlist from one of your saved presets.
            </p>
            <fieldset class="filter-group">
                <legend>Schedule your playlist</legend>
                <div class="filter-grid" style="grid-template-columns: 2fr 1fr; gap: 1rem;">
                    <label>Preset to Schedule
                        <select id="schedule-preset-select">
                            <option value="">-- Select a saved preset --</option>
                        </select>
                    </label>
                    <label>Playlist Name
                        <input type="text" id="schedule-playlist-name" value="MixerBee Scheduled">
                    </label>
                </div>
                <div class="filter-grid" style="grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                     <label>Frequency
                        <select id="schedule-frequency">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                        </select>
                    </label>
                    <label>Run At
                        <select id="schedule-time-select">
                            <optgroup label="Morning">
                                <option value="05:00">5:00 AM</option>
                                <option value="05:30">5:30 AM</option>
                                <option value="06:00">6:00 AM</option>
                                <option value="06:30">6:30 AM</option>
                                <option value="07:00">7:00 AM</option>
                                <option value="07:30">7:30 AM</option>
                                <option value="08:00">8:00 AM</option>
                                <option value="08:30">8:30 AM</option>
                                <option value="09:00">9:00 AM</option>
                                <option value="09:30">9:30 AM</option>
                                <option value="10:00">10:00 AM</option>
                                <option value="10:30">10:30 AM</option>
                                <option value="11:00">11:00 AM</option>
                                <option value="11:30">11:30 AM</option>
                            </optgroup>
                            <optgroup label="Afternoon">
                                <option value="12:00">12:00 PM</option>
                                <option value="12:30">12:30 PM</option>
                                <option value="13:00">1:00 PM</option>
                                <option value="13:30">1:30 PM</option>
                                <option value="14:00">2:00 PM</option>
                                <option value="14:30">2:30 PM</option>
                                <option value="15:00">3:00 PM</option>
                                <option value="15:30">3:30 PM</option>
                                <option value="16:00">4:00 PM</option>
                                <option value="16:30">4:30 PM</option>
                            </optgroup>
                            <optgroup label="Evening">
                                <option value="17:00">5:00 PM</option>
                                <option value="17:30">5:30 PM</option>
                                <option value="18:00">6:00 PM</option>
                                <option value="18:30">6:30 PM</option>
                                <option value="19:00" selected>7:00 PM</option>
                                <option value="19:30">7:30 PM</option>
                                <option value="20:00">8:00 PM</option>
                                <option value="20:30">8:30 PM</option>
                                <option value="21:00">9:00 PM</option>
                                <option value="21:30">9:30 PM</option>
                                <option value="22:00">10:00 PM</option>
                                <option value="22:30">10:30 PM</option>
                                <option value="23:00">11:00 PM</option>
                            </optgroup>
                             <optgroup label="Late Night">
                                <option value="23:30">11:30 PM</option>
                                <option value="00:00">12:00 AM (Midnight)</option>
                                <option value="00:30">12:30 AM</option>
                                <option value="01:00">1:00 AM</option>
                                <option value="01:30">1:30 AM</option>
                                <option value="02:00">2:00 AM</option>
                            </optgroup>
                        </select>
                    </label>
                </div>
            </fieldset>

            <fieldset id="schedule-days-container" class="filter-group" style="display: none;">
                <legend>Days of the Week</legend>
                <div id="schedule-days-checkboxes" class="checkbox-grid">
                    <label><input type="checkbox" name="schedule-day" value="1"> Mon</label>
                    <label><input type="checkbox" name="schedule-day" value="2"> Tue</label>
                    <label><input type="checkbox" name="schedule-day" value="3"> Wed</label>
                    <label><input type="checkbox" name="schedule-day" value="4"> Thu</label>
                    <label><input type="checkbox" name="schedule-day" value="5"> Fri</label>
                    <label><input type="checkbox" name="schedule-day" value="6"> Sat</label>
                    <label><input type="checkbox" name="schedule-day" value="0"> Sun</label>
                </div>
            </fieldset>

            <div class="button-group" style="justify-content: flex-end; margin-top: 1rem;">
                <button id="create-schedule-btn">Create Schedule</button>
            </div>

            <ul id="schedules-list">
            </ul>
        </div>
    </div>
    
    <div id="manager-pane" class="tab-pane" style="display: none;">
        <div class="container">
             <h3>Manage Playlists & Collections</h3>
             <input type="search" id="manager-search-input" placeholder="Filter by name..." style="width: 100%; margin-bottom: 1rem; box-sizing: border-box;">
             <div class="table-container">
                 <table>
                     <thead>
                         <tr>
                             <th class="sortable sort-asc" data-sort="Name">Name</th>
                             <th class="sortable" data-sort="DisplayType">Type</th>
                             <th class="sortable" data-sort="ItemCount">Items</th>
                             <th class="sortable" data-sort="DateCreated">Created</th>
                             <th>Actions</th>
                         </tr>
                     </thead>
                     <tbody>
                         <!-- Rows will be inserted by JS -->
                     </tbody>
                 </table>
             </div>
        </div>
    </div>


    <div id="action-bar">
        <div class="action-bar-content">
            <input id="action-bar-playlist-name" type="text" placeholder="Enter a name for your Playlist or Collection...">
            <button id="generate-mixed-playlist-btn">Build</button>
            <label class="action-bar-checkbox-label">
                <input type="checkbox" id="create-as-collection-cb">
                <span>Create as Collection</span>
            </label>
            <div class="theme-switcher">
                <label for="theme-toggle-cb" class="theme-toggle-label">
                    <i data-feather="moon"></i>
                    <input type="checkbox" id="theme-toggle-cb">
                    <span class="slider"></span>
                    <i data-feather="sun"></i>
                </label>
            </div>
        </div>
    </div>

    <div id="save-preset-modal-overlay" class="modal-overlay" style="display: none;">
        <div class="modal-window">
            <div class="modal-header">
                <h2>Save Preset</h2>
                <button id="save-preset-close-btn" class="icon-btn">×</button>
            </div>
            <div class="modal-body">
                <label for="preset-name-input" style="font-weight: 600; display: block; margin-bottom: 0.5rem;">Preset Name</label>
                <input type="text" id="preset-name-input" placeholder="e.g., Sci-Fi Favorites" style="width: 100%; box-sizing: border-box;">
                <div id="preset-overwrite-warning" style="color: var(--danger); font-size: 0.9em; margin-top: 0.5rem; display: none;">
                    Warning: A preset with this name already exists. Saving will overwrite it.
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-preset-cancel-btn" type="button" class="secondary">Cancel</button>
                <button id="save-preset-confirm-btn" type="button">Save</button>
            </div>
        </div>
    </div>

    <div id="smart-playlist-modal-overlay" class="modal-overlay" style="display: none;">
        <div class="modal-window">
            <div class="modal-header">
                <h2 id="smart-playlist-title">Create Playlist</h2>
                <button id="smart-playlist-close-btn" class="icon-btn">×</button>
            </div>
            <div class="modal-body">
                <p id="smart-playlist-description"></p>
                <div class="modal-form-layout">
                    <label class="control-item">
                        <span>Playlist Name</span>
                        <input type="text" id="smart-playlist-name-input">
                    </label>
                    <label class="control-item">
                        <span id="smart-playlist-count-label">Number of Items</span>
                        <input type="number" id="smart-playlist-count-input" min="1" value="10">
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button id="smart-playlist-cancel-btn" type="button" class="secondary">Cancel</button>
                <button id="smart-playlist-confirm-btn" type="button">Create</button>
            </div>
        </div>
    </div>

    <div id="import-preset-modal-overlay" class="modal-overlay" style="display: none;">
        <div class="modal-window">
            <div class="modal-header">
                <h2>Import Preset</h2>
                <button id="import-preset-close-btn" class="icon-btn">×</button>
            </div>
            <div class="modal-body">
                 <div class="modal-form-layout">
                    <label class="control-item">
                        <span>Share Code</span>
                        <textarea id="import-code-input" rows="4" placeholder="Paste share code here..."></textarea>
                    </label>
                    <label class="control-item">
                        <span>New Preset Name</span>
                        <input type="text" id="import-name-input" placeholder="e.g., Friend's Movie Mix">
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button id="import-preset-cancel-btn" type="button" class="secondary">Cancel</button>
                <button id="import-preset-confirm-btn" type="button">Import</button>
            </div>
        </div>
    </div>

    <div id="loading-overlay" style="display: none;">
        <div class="spinner"></div>
    </div>

    <script src="/static/vendor/Sortable.min.js"></script>
    <script src="/static/vendor/feather.min.js"></script>
    <script>
      feather.replace()
    </script>
    <script src="/static/app.js" type="module" defer></script>
</body>
</html>
